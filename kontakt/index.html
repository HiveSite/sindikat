<!doctype html>
<html lang="sr">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Kontakt – minimal test</title>
<body style="background:#111;color:#eee;font:16px/1.4 system-ui;padding:24px">
  <h1>Kontakt – minimal</h1>
  <form id="f" style="max-width:560px;background:#1a1a1a;border:1px solid #333;border-radius:12px;padding:16px">
    <div>
      <label>Vi ste*:
        <label><input type="radio" name="tip" value="Fizičko lice" checked> Fizičko lice</label>
        <label><input type="radio" name="tip" value="Kompanija"> Kompanija</label>
      </label>
    </div>
    <div style="display:flex;gap:8px;margin-top:8px">
      <input name="ime" placeholder="Ime i prezime*" required style="flex:1;background:#222;border:1px solid #444;border-radius:8px;padding:10px;color:#fff">
      <input id="komp" name="kompanija" placeholder="Kompanija*" style="flex:1;background:#222;border:1px solid #444;border-radius:8px;padding:10px;color:#fff;display:none">
    </div>
    <div style="display:flex;gap:8px;margin-top:8px">
      <input type="email" name="email" placeholder="Email*" required style="flex:1;background:#222;border:1px solid #444;border-radius:8px;padding:10px;color:#fff">
      <input name="telefon" placeholder="Telefon" style="flex:1;background:#222;border:1px solid #444;border-radius:8px;padding:10px;color:#fff">
    </div>
    <div style="display:flex;gap:8px;margin-top:8px">
      <select name="tipDogadjaja" style="flex:1;background:#222;border:1px solid #444;border-radius:8px;padding:10px;color:#fff">
        <option value="">Tip događaja…</option>
        <option>Korpo event</option><option>Privatni event</option><option>Vjenčanje</option><option>Promo</option>
      </select>
      <select name="gosti" style="flex:1;background:#222;border:1px solid #444;border-radius:8px;padding:10px;color:#fff">
        <option value="">Broj gostiju…</option>
        <option>do 50</option><option>50–150</option><option>150–300</option><option>300+</option>
      </select>
    </div>
    <div style="display:flex;gap:8px;margin-top:8px">
      <input type="date" name="datum" style="flex:1;background:#222;border:1px solid #444;border-radius:8px;padding:10px;color:#fff">
      <input name="lokacija" placeholder="Lokacija" style="flex:1;background:#222;border:1px solid #444;border-radius:8px;padding:10px;color:#fff">
      <select name="budzet" style="flex:1;background:#222;border:1px solid #444;border-radius:8px;padding:10px;color:#fff">
        <option value="">Budžet…</option>
        <option>< 1.000 €</option><option>1.000 – 3.000 €</option><option>3.000 – 7.000 €</option><option>7.000+ €</option>
      </select>
    </div>
    <fieldset style="margin-top:8px;border:1px solid #333;border-radius:8px;padding:8px">
      <legend style="padding:0 6px">Usluge</legend>
      <label><input type="checkbox" name="usluge" value="Planiranje i produkcija"> Planiranje i produkcija</label>
      <label><input type="checkbox" name="usluge" value="Barmeni i kokteli"> Barmeni i kokteli</label>
      <label><input type="checkbox" name="usluge" value="DJ / Muzika uživo"> DJ / Muzika uživo</label>
      <label><input type="checkbox" name="usluge" value="Zvuk i rasvjeta"> Zvuk i rasvjeta</label>
    </fieldset>
    <div style="margin-top:8px">
      <textarea name="poruka" rows="4" required placeholder="Detalji / poruka*" style="width:100%;background:#222;border:1px solid #444;border-radius:8px;padding:10px;color:#fff"></textarea>
    </div>
    <label style="display:flex;gap:8px;align-items:flex-start;margin-top:8px;font-size:14px;color:#bbb">
      <input type="checkbox" required style="margin-top:4px"> Saglasan/na sam da se podaci koriste za ponudu i komunikaciju.
    </label>
    <input type="hidden" name="source" value="Sindikat – Kontakt test">
    <div style="display:flex;align-items:center;gap:10px;margin-top:12px">
      <button id="btn" type="submit" style="background:#FFD700;color:#000;font-weight:700;border:0;border-radius:999px;padding:10px 18px">Pošalji upit</button>
      <span id="state" style="font-size:14px;color:#aaa"></span>
    </div>
  </form>

  <script>
  (function(){
    const SCRIPT_URL = 'PASTE_YOUR_EXEC_URL_HERE'; // <- tvoj /exec
    const f = document.getElementById('f');
    const btn = document.getElementById('btn');
    const state = document.getElementById('state');
    const komp = document.getElementById('komp');

    // toggle Kompanija
    f.addEventListener('change', (e)=>{
      if(e.target.name==='tip'){
        const show = (e.target.value==='Kompanija');
        komp.style.display = show ? 'block' : 'none';
        komp.required = show;
      }
    });

    f.addEventListener('submit', async (e)=>{
      e.preventDefault();

      if(!f.ime.value.trim() || !f.email.value.trim() || !f.poruka.value.trim()){
        state.textContent = 'Popunite: Ime, Email, Poruka.'; state.style.color='#f88'; return;
      }

      const usluge = Array.from(f.querySelectorAll('input[name="usluge"]:checked')).map(x=>x.value);

      const payload = {
        tip: (f.querySelector('input[name="tip"]:checked')||{}).value || '',
        ime: f.ime.value.trim(),
        email: f.email.value.trim(),
        telefon: f.telefon.value.trim(),
        kompanija: f.kompanija ? f.kompanija.value.trim() : '',
        pib: '', pozicija: '',
        tipDogadjaja: f.tipDogadjaja.value,
        gosti: f.gosti.value,
        datum: f.datum.value,
        lokacija: f.lokacija.value.trim(),
        budzet: f.budzet.value,
        usluge,
        poruka: f.poruka.value.trim(),
        source: f.source.value,
        utm_source:'',utm_medium:'',utm_campaign:'',
        userAgent: navigator.userAgent
      };

      btn.disabled = true; btn.textContent='Šaljem…'; state.textContent=''; state.style.color='#aaa';
      try{
        const resp = await fetch(SCRIPT_URL, {
          method:'POST',
          headers:{ 'Content-Type':'text/plain;charset=utf-8' }, // simple request → nema preflight
          body: JSON.stringify(payload)
        });
        const text = await resp.text();
        let data={}; try{ data=JSON.parse(text); }catch(e){ data={ok:false,error:text.slice(0,200)} }
        if(resp.ok && data.ok){
          state.textContent='Hvala! Poslato ✅'; state.style.color='#6f6';
          f.reset(); komp.style.display='none'; komp.required=false;
        }else{
          throw new Error(data.error || ('HTTP '+resp.status));
        }
      }catch(err){
        console.error(err);
        state.textContent='Greška pri slanju. Probajte ponovo.'; state.style.color='#f88';
      }finally{
        btn.disabled=false; btn.textContent='Pošalji upit';
      }
    });
  })();
  </script>
</body>
</html>
